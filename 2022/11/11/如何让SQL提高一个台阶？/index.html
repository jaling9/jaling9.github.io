

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="../../../../img/m.jpeg">
  <link rel="icon" href="../../../../img/m.jpeg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Marsh">
  <meta name="keywords" content="">
  
    <meta name="description" content="MySQl 专栏持续更新 不说晦涩难懂的东西 尽量输出容易理解 和 使用的SQL技巧 和 初中级开发不是很常用的但很有用的知识 欢迎查看👉🏻👉🏻👉🏻SQL 专栏 查漏补缺 指教一二  每一次写博客对技术都会有更深入的理解 积少成多 百天计划我也想看看自己有多少成长 祝君好运 工作顺利  前言SQL 写不好 加班少不了 日常工作中SQL 是必不可少的一项技术 但是很多人不会过多的去关注">
<meta property="og:type" content="article">
<meta property="og:title" content="如何让SQL提高一个台阶？">
<meta property="og:url" content="http://example.com/2022/11/11/%E5%A6%82%E4%BD%95%E8%AE%A9SQL%E6%8F%90%E9%AB%98%E4%B8%80%E4%B8%AA%E5%8F%B0%E9%98%B6%EF%BC%9F/index.html">
<meta property="og:site_name" content="MARSH">
<meta property="og:description" content="MySQl 专栏持续更新 不说晦涩难懂的东西 尽量输出容易理解 和 使用的SQL技巧 和 初中级开发不是很常用的但很有用的知识 欢迎查看👉🏻👉🏻👉🏻SQL 专栏 查漏补缺 指教一二  每一次写博客对技术都会有更深入的理解 积少成多 百天计划我也想看看自己有多少成长 祝君好运 工作顺利  前言SQL 写不好 加班少不了 日常工作中SQL 是必不可少的一项技术 但是很多人不会过多的去关注">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://images.unsplash.com/photo-1497864979123-ef3595423b92?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80">
<meta property="article:published_time" content="2022-11-11T14:49:20.594Z">
<meta property="article:modified_time" content="2022-11-18T15:29:48.290Z">
<meta property="article:author" content="Marsh">
<meta property="article:tag" content="转载">
<meta property="article:tag" content="SQL">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://images.unsplash.com/photo-1497864979123-ef3595423b92?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80">
  
  
  
  <title>如何让SQL提高一个台阶？ - MARSH</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="../../../../css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="../../../../css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="../../../../css/highlight-dark.css" />
  



  
<link rel="stylesheet" href="../css/custom.css">



  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.9.3","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":false,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":"img/emoji-hover.jpg"},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"left","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":true,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="../../../../js/utils.js" ></script>
  <script  src="../../../../js/color-schema.js" ></script>
  

  

  

  

  

  

  

  



  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="../../../../index.html">
      <strong>MARSH</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../index.html">
                
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                
                Categories
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../categories">
                    
                    全部
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90">
                    
                    数据分析
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../categories/%E5%BC%80%E5%8F%91">
                    
                    开发
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../categories/%E8%AE%A1%E7%AE%97%E6%9C%BA">
                    
                    计算机
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../categories/%E5%8D%9A%E5%AE%A2">
                    
                    博客
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../categories/%E5%85%B6%E4%BB%96">
                    
                    其他
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" target="_self" href="javascript:;" role="button"
                 data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                
                Tags
              </a>
              <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags">
                    
                    全部
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/%E5%8E%9F%E5%88%9B">
                    
                    原创
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/%E8%BD%AC%E8%BD%BD">
                    
                    转载
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/SQL">
                    
                    SQL
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/Python">
                    
                    Python
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/Sklearn">
                    
                    SKlearn
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/Flask">
                    
                    Flask
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/Golang">
                    
                    Golang
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/Markdown">
                    
                    Markdown
                  </a>
                
                  
                  
                  
                  <a class="dropdown-item" href="../../../../tags/Hexo">
                    
                    Hexo
                  </a>
                
              </div>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="../../../../about/">
                
                About
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('https://images.unsplash.com/photo-1497864979123-ef3595423b92?ixlib=rb-4.0.3&ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&auto=format&fit=crop&w=2370&q=80') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="如何让SQL提高一个台阶？"></span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        Marsh
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-11 22:49" pubdate>
          November 11, 2022 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          7.5k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          63 mins
        
      </span>
    

    
    
      
        <span id="leancloud-page-views-container" class="post-meta" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="leancloud-page-views"></span> views
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="padding-left: 2rem; margin-right: -1rem">
    <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;Table of Contents</p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">如何让SQL提高一个台阶？</h1>
            
              <p class="note note-info">
                
                  
                    Last updated on November 18, 2022 pm
                  
                
              </p>
            
            
              <div class="markdown-body">
                
                <blockquote>
<p>MySQl 专栏持续更新 不说晦涩难懂的东西 尽量输出容易理解 和 使用的SQL技巧 和 初中级开发不是很常用的但很有用的知识</p>
<p>欢迎查看👉🏻👉🏻👉🏻<a target="_blank" rel="noopener" href="https://juejin.cn/column/7157955810826387470" title="https://juejin.cn/column/7157955810826387470">SQL 专栏</a> 查漏补缺 指教一二</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9572ab2e6c3545dbaa4b2b75f4a3b6c1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="src=http __img2.biaoqingjia.com_biaoqing_201810_2c3993f64eec252da6d674f9d80fc4e9.gif&amp;refer=http __img2.biaoqingjia.gif"></p>
<p>每一次写博客对技术都会有更深入的理解 积少成多 百天计划我也想看看自己有多少成长 祝君好运 工作顺利</p>
</blockquote>
<h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>SQL 写不好 加班少不了 日常工作中SQL 是必不可少的一项技术 但是很多人不会过多的去关注SQL问题 一是数据量小 二是没有意识到索引的重要性 本文主要是整理 SQL失效场景 如果里面的细节你都知道 那你一定是学习能力比较好的人 膜拜 写完这篇文章 我感觉自己之前知道的真的是 “目录” 没有明白其中的内容 如果你能跟着节奏看完文章 一定会有收获 至少我写完感觉思维通透很多 以后百分之九十的 SQl索引问题 和 面试这方面问题都能拿捏两</p>
<p><code>文章 字数 四千余字 观看时长十分钟 练习时长两个半小时</code></p>
<h2 id="基础数据准备"><a href="#基础数据准备" class="headerlink" title="基础数据准备"></a>基础数据准备</h2><p>准备一个数据表作为 数据演示 这里面一共 创建了三个索引</p>
<ul>
<li>联合索引 <code>sname</code>, <code>s_code</code>, <code>address</code></li>
<li>主键索引 <code>id</code></li>
<li>普通索引 <code>height</code></li>
</ul>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">SET NAMES utf8mb4;
SET FOREIGN_KEY_CHECKS &#x3D; 0;

-- ----------------------------
-- Table structure for student
-- ----------------------------
DROP TABLE IF EXISTS &#96;student&#96;;
CREATE TABLE &#96;student&#96;  (
  &#96;id&#96; int(11) NOT NULL AUTO_INCREMENT,
  &#96;sname&#96; varchar(20) CHARACTER SET utf8 COLLATE utf8_general_ci NOT NULL,
  &#96;s_code&#96; int(100) NULL DEFAULT NULL,
  &#96;address&#96; varchar(100) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,
  &#96;height&#96; double NULL DEFAULT NULL,
  &#96;classid&#96; int(11) NULL DEFAULT NULL,
  &#96;create_time&#96; datetime(0) NOT NULL ON UPDATE CURRENT_TIMESTAMP(0),
  PRIMARY KEY (&#96;id&#96;) USING BTREE,
  INDEX &#96;普通索引&#96;(&#96;height&#96;) USING BTREE,
  INDEX &#96;联合索引&#96;(&#96;sname&#96;, &#96;s_code&#96;, &#96;address&#96;) USING BTREE
) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 5 CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;

-- ----------------------------
-- Records of student
-- ----------------------------
INSERT INTO &#96;student&#96; VALUES (1, &#39;学生1&#39;, 1, &#39;上海&#39;, 170, 1, &#39;2022-11-02 20:44:14&#39;);
INSERT INTO &#96;student&#96; VALUES (2, &#39;学生2&#39;, 2, &#39;北京&#39;, 180, 2, &#39;2022-11-02 20:44:16&#39;);
INSERT INTO &#96;student&#96; VALUES (3, &#39;变成派大星&#39;, 3, &#39;京东&#39;, 185, 3, &#39;2022-11-02 20:44:19&#39;);
INSERT INTO &#96;student&#96; VALUES (4, &#39;学生4&#39;, 4, &#39;联通&#39;, 190, 4, &#39;2022-11-02 20:44:25&#39;);</code></pre></div></figure>

<h2 id="正文"><a href="#正文" class="headerlink" title="正文"></a>正文</h2><p>上面的SQL 我们已经创建好基本的数据 在验证之前 先带着几个问题</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a517883c2f734ed9aad32fe69341e5b2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>我们先从上往下进行验证</p>
<h2 id="最左匹配原则"><a href="#最左匹配原则" class="headerlink" title="最左匹配原则"></a>最左匹配原则</h2><p>写在前面：我很早之前就听说过数据库的最左匹配原则，当时是通过各大博客论坛了解的，但是这些博客的局限性在于它们对最左匹配原则的描述就像一些数学定义一样，往往都是列出123点，满足这123点就能匹配上索引，否则就不能。 最左匹配原则就是指在联合索引中，如果你的 SQL 语句中用到了联合索引中的最左边的索引，那么这条 SQL 语句就可以利用这个联合索引去进行匹配，我们上面建立了联合索引 可以用来测试最左匹配原则 <code>sname</code>, <code>s_code</code>, <code>address</code></p>
<p>请看下面SQL语句 进行思考 是否会走索引</p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">-- 联合索引 sname,s_code,address

1、select create_time from student where sname &#x3D; &quot;变成派大星&quot;  -- 会走索引吗？

2、select create_time from student where s_code &#x3D; 1   -- 会走索引吗？

3、select create_time from student where address &#x3D; &quot;上海&quot;  -- 会走索引吗？

4、select create_time from student where address &#x3D; &quot;上海&quot; and s_code &#x3D; 1 -- 会走索引吗？

5、select create_time from student where address &#x3D; &quot;上海&quot; and sname &#x3D; &quot;变成派大星&quot;  -- 会走索引吗？

6、select create_time from student where sname &#x3D; &quot;变成派大星&quot; and address &#x3D; &quot;上海&quot;  -- 会走索引吗？

7、select create_time from student where sname &#x3D; &quot;变成派大星&quot; and s_code &#x3D; 1 and address &#x3D; &quot;上海&quot;  -- 会走索引吗？</code></pre></div></figure>

<p>凭你的经验 哪些会使用到索引呢 ？ 可以先思考一下 在心中记下数字</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/783520d8f38b4e259e8f6d7b65a05103~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><strong>走索引例子</strong></p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">EXPLAIN  select create_time from student where sname &#x3D; &quot;变成派大星&quot;  -- 会走索引吗？</code></pre></div></figure>

<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d253165cfba04252aa4c4a219b697a81~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><strong>未走索引例子</strong></p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">EXPLAIN select create_time from student where address &#x3D; &quot;上海&quot; and s_code &#x3D; 1 -- 会走索引吗？</code></pre></div></figure>

<p>走的全表扫描 rows &#x3D; 4 <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9395730bd49645f1848278ff1d7d2467~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"> 如果不知道<code>EXPLAIN</code> 是什么的 或者看不懂分析出来的数据的话 建议去看看另一篇文章<a target="_blank" rel="noopener" href="https://juejin.cn/post/7161254854571065375" title="https://juejin.cn/post/7161254854571065375">分析命令EXPLAIN超详解</a></p>
<p>如果你内心的答案没有全部说对就接着往下看</p>
<p>最左匹配原则顾名思义：最左优先，以最左边的为起点任何连续的索引都能匹配上。<strong>同时遇到范围查询(&gt;、&lt;、between、like)就会停止匹配</strong>。<br>例如：s_code &#x3D; 2 如果建立(<code>sname</code>, <code>s_code</code>)顺序的索引，是匹配不到(<code>sname</code>, <code>s_code</code>)索引的;</p>
<p>但是如果查询条件是sname &#x3D; “变成派大星” and s_code &#x3D; 2或者a&#x3D;1(又或者是s_code &#x3D; 2 and sname &#x3D; “变成派大星” )就可以，<strong>因为优化器会自动调整<code>sname</code>, <code>s_code</code>的顺序</strong>。再比如sname &#x3D; “变成派大星” and s_code &gt; 1 and address &#x3D; “上海” <code>address是用不到索引的</code>，因为s_code字段是一个范围查询，它之后的字段会停止匹配。</p>
<p>不带范围查询 索引使用类型 <img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/62cf1fbb4d694a32b1374a7621259924~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>带范围使用类型</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8bf03bef225405b83de31f9ffcdd1af~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>根据上一篇文章的讲解 可以明白 ref 和range的含义 级别还是相差很多的</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/dd7c90f9067344fdaa91724d0f6882f1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><p>为什么左链接一定要遵循最左缀原则呢？</p>
<h3 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h3><p>看过一个比较好玩的回答</p>
<blockquote>
<p>你可以认为联合索引是闯关游戏的设计<br>例如你这个联合索引是state&#x2F;city&#x2F;zipCode<br>那么state就是第一关 city是第二关， zipCode就是第三关<br>你必须匹配了第一关，才能匹配第二关，匹配了第一关和第二关，才能匹配第三关</p>
</blockquote>
<p>这样描述不算完全准确 但是确实是这种思想</p>
<p>要想理解联合索引的最左匹配原则，先来理解下索引的底层原理。索引的底层是一颗B+树，那么联合索引的底层也就是一颗B+树，只不过联合索引的B+树节点中存储的是键值。由于构建一棵B+树只能根据一个值来确定索引关系，所以数据库依赖联合索引最左的字段来构建 文字比较抽象 我们看一下</p>
<p>加入我们建立 A,B 联合索引 他们在底层储存是什么样子呢？</p>
<ul>
<li>橙色代表字段 A</li>
<li>浅绿色 代表字段B</li>
</ul>
<p>图解： <img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a35b2ec784eb48109fe2916eade3c248~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>我们可以看出几个特点</p>
<ul>
<li>A 是有顺序的 1，1，2，2，3，4</li>
<li>B 是没有顺序的 1，2，1，4，1，2 这个是散列的</li>
<li>如果A是等值的时候 B是有序的 例如 （1，1），（1，2） 这里的B有序的 （2，1）,(2,4) B 也是有序的</li>
</ul>
<p>这里应该就能看出 如果没有A的支持 B的索引是散列的 不是连续的</p>
<p>再细致一点 我们重新创建一个表</p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">DROP TABLE IF EXISTS &#96;leftaffix&#96;;

CREATE TABLE &#96;leftaffix&#96;  (

  &#96;a&#96; int(11) NOT NULL AUTO_INCREMENT,

  &#96;b&#96; int(11) NULL DEFAULT NULL,

  &#96;c&#96; int(11) NULL DEFAULT NULL,

  &#96;d&#96; int(11) NULL DEFAULT NULL,

  &#96;e&#96; varchar(11) CHARACTER SET utf8 COLLATE utf8_general_ci NULL DEFAULT NULL,

  PRIMARY KEY (&#96;a&#96;) USING BTREE,

  INDEX &#96;联合索引&#96;(&#96;b&#96;, &#96;c&#96;, &#96;d&#96;) USING BTREE

) ENGINE &#x3D; InnoDB AUTO_INCREMENT &#x3D; 8 CHARACTER SET &#x3D; utf8 COLLATE &#x3D; utf8_general_ci ROW_FORMAT &#x3D; Dynamic;
 
-- ----------------------------
-- Records of leftaffix
-- ----------------------------
INSERT INTO &#96;leftaffix&#96; VALUES (1, 1, 1, 1, &#39;1&#39;);

INSERT INTO &#96;leftaffix&#96; VALUES (2, 2, 2, 2, &#39;2&#39;);

INSERT INTO &#96;leftaffix&#96; VALUES (3, 3, 2, 2, &#39;3&#39;);

INSERT INTO &#96;leftaffix&#96; VALUES (4, 3, 1, 1, &#39;4&#39;);

INSERT INTO &#96;leftaffix&#96; VALUES (5, 2, 3, 5, &#39;5&#39;);

INSERT INTO &#96;leftaffix&#96; VALUES (6, 6, 4, 4, &#39;6&#39;);

INSERT INTO &#96;leftaffix&#96; VALUES (7, 8, 8, 8, &#39;7&#39;);
SET FOREIGN_KEY_CHECKS &#x3D; 1;</code></pre></div></figure>

<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/39277837f4fb4f8d8f4707ae5a597880~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<blockquote>
<p>在创建索引树的时候会对数据进行排序 根据最左缀原则 会先通过 B 进行排序 也就是 如果出现值相同就 根据 C 排序 如果 C相同就根据D 排序 排好顺序之后就是如下图：</p>
</blockquote>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/311f0f59b47141a185b466f26df0d2e0~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<blockquote>
<p>索引的生成就会根据图二的顺序进行生成 我们看一下 生成后的树状数据是什么样子</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cb22bb31c6f14d3683164388042bc0f1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<blockquote>
<p>解释一些这个树状图 首先根据图二的排序 我们知道顺序 是 1111a 2222b 所以 在第三层 我们可以看到 1111a 在第一层 2222b在第二层 因为 111 &lt; 222 所以 111 进入第二层 然后得出第一层</p>
</blockquote>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5393546a6d59417388538798c34ca04f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>简化一下就是这个样子</p>
<p>但是这种顺序是相对的。这是因为MySQL创建联合索引的规则是首先会对联合索引的最左边<code>第一个字段排序</code>，在第一个字段的排序基础上，然后在对第二个字段进行排序。所以B&#x3D;2这种查询条件没有办法利用索引。</p>
<p>看到这里还可以明白一个道理 为什么我们建立索引的时候不推荐建立在经常改变的字段 因为这样的话我们的索引结构就要跟着你的改变而改动 所以很消耗性能</p>
<h3 id="小总结"><a href="#小总结" class="headerlink" title="小总结"></a>小总结</h3><p>前提 如果创建 b,c,d 联合索引面</p>
<ul>
<li>如果 我where 后面的条件是<code>c = 1 and d = 1</code>为什么不能走索引呢 如果没有b的话 你查询的值相当于 <code>*11</code> 我们都知道<code>*</code>是所有的意思也就是我能匹配到所有的数据</li>
<li>如果 我 where 后面是 <code>b = 1 and d =1</code> 为什么会走索引呢？ 你等于查询的数据是 <code>1*1</code> 我可以通过前面 1 进行索引匹配 所以就可以走索引</li>
<li>最左缀匹配原则的最重要的就是 第一个字段</li>
</ul>
<p>我们接着看下一个失效场景</p>
<h2 id="select"><a href="#select" class="headerlink" title="select *"></a>select *</h2><h3 id="思考-1"><a href="#思考-1" class="headerlink" title="思考"></a>思考</h3><p>首先提出问题 <code>select *</code> 一定会索引失效吗？</p>
<h3 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h3><p>如果你的心里答案是 会失效那就接着往下看</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f81456c6434c4beda1388db375956a17~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>细心的同学能够发现 即便我使用了select * 依然会走索引 这是为什么呢？</p>
<p>首先我们在上一个验证中创建了联合索引 我们使用B&#x3D;1 会走索引</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c32c8aa321f3458b95a00ae04ec8c37b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6d5e676c05644c1aaaf62a5f214354b3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>也就是 Select * 在一些情况下是会走索引的 那么什么时候不会走索引呢</p>
<blockquote>
<p>经过测试 在查询返回结果集大约总数据的25%就不会走索引了 进而全表扫描 这里也有一个知识点 也就是为什么范围查找会索引失效的原因</p>
</blockquote>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/641cc7d7b0ad4d04aa9417f721ca7be1~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>上图就是索引失效的情况</p>
<p>范围查找也不是一定会索引失效 下面情况就会索引生效就是 级别低 生效的原因是因为缩小了范围</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/05fab88741414b70896dedc185d6a3ff~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h3 id="小总结-1"><a href="#小总结-1" class="headerlink" title="小总结"></a>小总结</h3><ul>
<li>select * 只有在返回结果集数量大于总结果集的25% 就会造成索引失效 如果小于 不会造成索引失效但是会降低索引的效率</li>
<li>范围查找有概率索引失效但是 但是在特定的情况下会生效 范围小就会使用 也可以理解为 返回结果集小就会使用索引</li>
</ul>
<h2 id="使用函数"><a href="#使用函数" class="headerlink" title="使用函数"></a>使用函数</h2><p>使用在Select 后面使用函数可以使用索引 但是下面这种做法就不能</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/48f8fee5fda042b4a21ba190a68dbca2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b22c7170e6bd4c9084e6f0dc01521412~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>因为索引保存的是索引字段的原始值，而不是经过函数计算后的值，自然就没办法走索引了。</p>
<p>不过，从 MySQL 8.0 开始，索引特性增加了函数索引，即可以针对函数计算后的值建立一个索引，也就是说该索引的值是函数计算后的值，所以就可以通过扫描索引来查询数据。</p>
<p>这种写法我没使用过 感觉情况比较少 也比较容易注意到这种写法</p>
<h2 id="计算操作"><a href="#计算操作" class="headerlink" title="计算操作"></a>计算操作</h2><p>这个情况和上面一样 之所以会导致索引失效是因为改变了索引原来的值 在树中找不到对应的数据只能全表扫描</p>
<p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2c4ce2c6583a4107aab778669bf1b775~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"> 因为索引保存的是索引字段的原始值，而不是 b - 1 表达式计算后的值，所以无法走索引，只能通过把索引字段的取值都取出来，然后依次进行表达式的计算来进行条件判断，因此采用的就是全表扫描的方式。</p>
<p>下面这种计算方式就会使用索引</p>
<p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ab31b17d52f44d4297c1a10248c97f33~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>Java比较熟悉的可能会有点疑问，这种对索引进行简单的表达式计算，在代码特殊处理下，应该是可以做到索引扫描的，比方将 b - 1 &#x3D; 6 变成 b &#x3D; 6 - 1。 是的，是能够实现，但是 MySQL 还是偷了这个懒，没有实现。</p>
<h3 id="小总结-2"><a href="#小总结-2" class="headerlink" title="小总结"></a>小总结</h3><p>总而言之 言而总之 只要是影响到索引列的值 索引就是失效</p>
<h2 id="Like"><a href="#Like" class="headerlink" title="Like %"></a>Like %</h2><p>这个真的是难受哦 因为经常使用这个 所以还是要小心点 在看为什么失效之前 我们先看一下 Like % 的解释</p>
<ol>
<li><strong>%百分号通配符:</strong> 表示任何字符出现任意次数(可以是0次).</li>
<li><strong>_下划线通配符:</strong> 表示只能匹配单个字符,不能多也不能少,就是一个字符.</li>
<li><strong>like操作符:</strong> LIKE作用是指示mysql后面的搜索模式是利用通配符而不是直接相等匹配进行比较.</li>
</ol>
<p><strong>注意:</strong> 如果在使用like操作符时,后面的没有使用通用匹配符效果是和&#x3D;一致的,</p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">SELECT * FROM products WHERE products.prod_name like &#39;1000&#39;;</code></pre></div></figure>

<p>2.匹配包含”Li”的记录(包括记录”Li”) :</p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">SELECT* FROM products WHERE products.prod_name like &#39;%Li%&#39;;</code></pre></div></figure>

<p>3.匹配以”Li”结尾的记录(包括记录”Li”,不包括记录”Li “,也就是Li后面有空格的记录,这里需要注意)</p>
<figure><div class="code-wrapper"><pre class="language-none"><code class="language-none">SELECT * FROM products WHERE products.prod_name like &#39;%Li&#39;;</code></pre></div></figure>

<p>在左不走 在右走</p>
<p><code>右：</code> 虽然走 但是索引级别比较低主要是模糊查询 范围比较大 所以索引级别就比较低 <img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c0fd95c00a9f44ffbed872907e23bd76~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><code>左：</code> 这个范围非常大 所以没有使用索引的必要了 这个可能不是很好优化 还好不是一直拼接上面的</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/183762e539b04420b6db1acc4a7cabbb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h3 id="小总结-3"><a href="#小总结-3" class="headerlink" title="小总结"></a>小总结</h3><p>索引的时候和查询范围关系也很大 范围过大造成索引没有意义从而失效的情况也不少</p>
<h2 id="使用Or导致索引失效"><a href="#使用Or导致索引失效" class="headerlink" title="使用Or导致索引失效"></a>使用Or导致索引失效</h2><p>这个原因就更简单了</p>
<p>在 WHERE 子句中，如果在 OR 前的条件列是索引列，而在 OR 后的条件列不是索引列，那么索引会失效 举个例子，比如下面的查询语句，b 是主键，e 是普通列，从执行计划的结果看，是走了全表扫描。</p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5fe15263f1414f058690cb11a02fdbbe~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h3 id="优化"><a href="#优化" class="headerlink" title="优化"></a>优化</h3><p>这个的优化方式就是 在Or的时候两边都加上索引</p>
<p>就会使用索引 避免全表扫描 <img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e2924e8c883046a793416a7e9f9307e4~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<h2 id="in使用不当"><a href="#in使用不当" class="headerlink" title="in使用不当"></a>in使用不当</h2><p>首先使用In 不是一定会造成全表扫描的 <strong>IN肯定会走索引，但是当IN的取值范围较大时会导致索引失效，走全表扫描</strong></p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8c6239288d63424f97463355bd4c459c~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/0a515623c61a403b86af444c7db46fa9~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<p>in 在结果集 大于30%的时候索引失效</p>
<h2 id="not-in-和-In的失效场景相同"><a href="#not-in-和-In的失效场景相同" class="headerlink" title="not in 和 In的失效场景相同"></a>not in 和 In的失效场景相同</h2><h2 id="order-By"><a href="#order-By" class="headerlink" title="order By"></a>order By</h2><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/664a7329241840e888d5569d4b0e3475~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"> 这一个主要是Mysql 自身优化的问题 我们都知道OrderBy 是排序 那就代表我需要对数据进行排序 如果我走索引 索引是排好序的 但是我需要回表 消耗时间 另一种 我直接全表扫描排序 不用回表 也就是</p>
<ul>
<li>走索引 + 回表</li>
<li>不走索引 直接全表扫描</li>
</ul>
<p>Mysql 认为直接全表扫面的速度比 回表的速度快所以就直接走索引了 在Order By 的情况下 走全表扫描反而是更好的选择</p>
<h2 id="子查询会走索引吗"><a href="#子查询会走索引吗" class="headerlink" title="子查询会走索引吗"></a>子查询会走索引吗</h2><p>答案是会 但是使用不好就不会</p>
<h2 id="大总结"><a href="#大总结" class="headerlink" title="大总结"></a>大总结</h2><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8f7104ac9d684ce3b4fe43e97b6afaf2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="图片.png"></p>
<ul>
<li>如果你是直接跳到这里 看看文章有多长 <code>建议收藏</code></li>
<li>如果你一步步看到这里 感觉有点帮助 <code>赞赞来一个</code></li>
<li>如果感觉文章有问题 建议评论区指出 <code>会修正</code></li>
</ul>
<p>周五愉快 文章完结🥰</p>
<p>持续更新SQL相关系列 可追更 不可催更</p>
<p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/bed95998e47144b4a49e8a42246ece50~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp" srcset="/img/loading.gif" lazyload alt="0bd2663ecc3e21c3a51f382cec4bb8b6.gif"></p>
<p><em><strong>本文正在参加<a target="_blank" rel="noopener" href="https://juejin.cn/post/7160601544600567845" title="https://juejin.cn/post/7160601544600567845">「技术专题19期 漫谈数据库技术」</a>活动</strong></em></p>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="../../../../categories/%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90/" class="category-chain-item">数据分析</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="../../../../tags/%E8%BD%AC%E8%BD%BD/">#转载</a>
      
        <a href="../../../../tags/SQL/">#SQL</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>如何让SQL提高一个台阶？</div>
      <div>http://example.com/2022/11/11/如何让SQL提高一个台阶？/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Marsh</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>November 11, 2022</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Updated on</div>
          <div>November 18, 2022</div>
        </div>
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="../../12/python%E8%BF%9E%E6%8E%A5MySQL/" title="Python如何与MySQL实现交互及常用sql语句">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">Python如何与MySQL实现交互及常用sql语句</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="../%E5%9F%BA%E4%BA%8E%20Hexo%20%E4%BB%8E%E9%9B%B6%E5%BC%80%E5%A7%8B%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/" title="基于 Hexo 从零开始搭建个人博客">
                        <span class="hidden-mobile">基于 Hexo 从零开始搭建个人博客</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  <article id="comments" lazyload>
    
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"JThobepyUWZ8wrCKpWzo5Vju-gzGzoHsz","appKey":"5l7p5rk6oXtEIST5bExEAMrT","path":"window.location.pathname","placeholder":null,"avatar":"retro","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":false,"recordIP":false,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":false},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


  </article>


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>
  </div>
</div>





  



  




  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> <div style="font-size: 0.85rem"> <span id="timeDate">载入天数...</span> <span id="times">载入时分秒...</span> <script src="/js/duration.js"></script> </div> 
    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="leancloud-site-pv-container" style="display: none">
        Views: 
        <span id="leancloud-site-pv"></span>
        
      </span>
    
    
      <span id="leancloud-site-uv-container" style="display: none">
        Visitors: 
        <span id="leancloud-site-uv"></span>
        
      </span>
    
    

  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="../../../../js/events.js" ></script>
<script  src="../../../../js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="../../../../js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="../../../../js/local-search.js" ></script>

  <script defer src="../../../../js/leancloud.js" ></script>




  
<script src="../js/custom.js"></script>



<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="../../../../js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
